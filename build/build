#!/usr/bin/env bash

set -e

# Builds 'service-register' docker image with the version given below. 
version="1.0.0"

# Create a release.tar that contains all the code. 
pushd ..
tar cf build/release.tar \
  --exclude .git \
  --exclude node_modules \
  --exclude build \
  .
popd

# Build the docker image (commented out)
echo "---------------------------- building service-register ----------------------"
pushd service-register
cp ../release.tar .
sudo docker build -f Dockerfile -t pryv/service-register:$version .
popd

echo "---------------------------- building register ------------------------------"
pushd register
cp ../release.tar .
sudo docker build -f Dockerfile -t pryv/register:$version .
sudo docker tag pryv/register:$version pryv/register:latest
popd

echo "---------------------------- building dns -----------------------------------"
pushd dns
cp ../release.tar .
sudo docker build -f Dockerfile -t pryv/dns:$version .
sudo docker tag pryv/dns:$version pryv/dns:latest
popd

